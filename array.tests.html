<!doctype html>
<html>
<head>
	<style type="text/css">
		body { text-align: center; padding: 0px; }
		.page { text-align: left; margin: 0px auto; width: 90%; padding: 0px; }
		.centered_container { text-align: center; padding: 10px; position: fixed; width: 100%; }
		.console {
			background-color: #222;
			color: #eee;
			font-size: 14px;
			line-height: 16px;
		}
		.scroll-area {
			overflow: scroll;
			border: 1px solid #333;
			border-radius: 3px;
			padding: 5px;
			margin: 5px;
		}
		#text-input {
			width: 95%;
			height: 50px;
		}
	</style>
</head>
<body>
	<div class="page">
		<div class="centered_container">
			<input type="button" value="run tests" id="run_tests" name="run_tests" />
		</div>
		<div id="char-count-output">#0</div>
		<div id="output" class="console scroll-area"></div>
		<div id="search_area" class="scroll-area variable-height silly-monkey">
			<textarea id="text-input"></textarea>
			<ul>
				<li class="odd">one</li>
				<li class="even">two</li>
				<li class="odd">three
					<ul>
						<li class="odd">three one</li>
						<li class="even">three two</li>
						<li class="odd">three three </li>
						<li class="even">three four</li>
						<li class="odd">three five</li>
						<li class="even">three six</li>
					</ul>
				</li>
				<li class="even">four</li>
				<li class="odd">five</li>
				<li class="even">six</li>
				<li class="user">seven</li>
				<li class="even">eight</li>
				<li class="odd">nine</li>
				<li class="even">ten</li>
				<li class="odd">eleven</li>
				<li class="even">twelve</li>
			</ul>
		</div>
	</div>
	
	<!-- <script src="js/jquery-1.6.js"></script> -->
	<script src="js/cragnon.array.js"></script>
	<script src="js/tests.js"></script>
	<script>
		var areas = document.querySelectorAll('.scroll-area'),
			buttonContainer = document.querySelectorAll('.centered_container'),
			index,
			wWidth,
			wHeight,
			areaHeight,
			area;

		window.onresize = function () {
			resizeUI();	
		};

		function resizeUI() {
			var areaHeightEst, areaHeight;
			wWidth = window.innerWidth;
			wHeight = window.innerHeight;
			//console.log('wHeight: ' + wHeight);

			areaHeightEst = wHeight;
			areaHeightEst = areaHeightEst - getElementHeightExtras(document.body);
			areaHeightEst = areaHeightEst / areas.length;

			for(index = 0; index < areas.length; index++) {
				area = areas[index];
				// get rid of the padding, margin, and border
				areaHeight = areaHeightEst - getElementHeightExtras(area); 
				area.style.height = areaHeight + 'px';
			}
		}

		function getElementHeight(element) {
			var style,
				paddingTop,
				paddingBottom,
				marginTop,
				marginBottom,
				borderTop,
				borderBottom,
				cssRulesRegEx = /\-(\w)/g;

			//console.log('defaultView');
			style = document.defaultView.getComputedStyle(element, '');
			elementHeight = element.offsetHeight;
			paddingTop = cragnon.trimUnit(style.getPropertyValue('padding-top'));
			paddingBottom = cragnon.trimUnit(style.getPropertyValue('padding-bottom'));
			marginTop = cragnon.trimUnit(style.getPropertyValue('margin-top'));
			marginBottom = cragnon.trimUnit(style.getPropertyValue('margin-bottom'));
			borderTop = cragnon.trimUnit(style.getPropertyValue('border-top-width'));
			borderBottom = cragnon.trimUnit(style.getPropertyValue('border-bottom-width'));
			
			elementHeight = elementHeight - (paddingTop + paddingBottom + marginTop + marginBottom + borderTop + borderBottom);
			
			// console.log('elementHeight: ' + elementHeight);

			return elementHeight;
		}

		function getElementHeightExtras(element) {
			var style,
				paddingTop,
				paddingBottom,
				marginTop,
				marginBottom,
				borderTop,
				borderBottom,
				cssRulesRegEx = /\-(\w)/g;

			// Standards Way; Not for IE
			style = document.defaultView.getComputedStyle(element, '');
			elementHeight = element.offsetHeight;
			paddingTop = trimUnit(style.getPropertyValue('padding-top'));
			paddingBottom = trimUnit(style.getPropertyValue('padding-bottom'));
			marginTop = trimUnit(style.getPropertyValue('margin-top'));
			marginBottom = trimUnit(style.getPropertyValue('margin-bottom'));
			borderTop = trimUnit(style.getPropertyValue('border-top-width'));
			borderBottom = trimUnit(style.getPropertyValue('border-bottom-width'));
			
			elementHeight = (paddingTop + 
							paddingBottom + 
							marginTop + 
							marginBottom + 
							borderTop + 
							borderBottom);
			
			return elementHeight;
		}
		function trimUnit(value) {
			if (typeof value === 'undefined' || value === null) {
				return parseFloat(0); // just return 0 if the value is null or undefined.
			}
			// get rid of anything that's not a number, period, or comma
			return parseFloat(value.replace(/[^,0-9\.]/gi, '')); // TODO: is the comma needed? can we strip it safely?
		}

		function calculateCharacterCount(text) {
			var output = document.querySelectorAll('#char-count-output')[0],
				charCount = 0;

			charCount = text.length;
			output.innerHTML = '#' + charCount + '';
		}

		var textBox = document.querySelectorAll('#text-input')[0];
		
		textBox.onkeyup = function (e) {
			calculateCharacterCount(this.value);
		};

		resizeUI();
	</script>
	<script>
		// ===========================================================
		// I don't have methods for attaching events yet. Do it the old fashioned way. :)
		
		var runTestButton = document.getElementById('run_tests');
		runTestButton.onclick = function (e) {
			runTests(); // see runTests function in test.js
		};
	</script>
</body>
</html>